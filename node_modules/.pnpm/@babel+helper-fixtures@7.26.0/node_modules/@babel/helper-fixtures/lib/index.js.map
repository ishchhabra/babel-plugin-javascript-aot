{"version":3,"names":["_semver","require","_path","_fs","_url","_module","nodeVersion","semver","clean","process","version","slice","humanize","val","noext","path","basename","extname","replace","tryResolve","module","resolve","_","assertDirectory","loc","fs","statSync","isDirectory","Error","shouldIgnore","name","ignore","includes","ext","base","EXTENSIONS","JSON_AND_EXTENSIONS","checkFile","allowJSON","matchedLoc","extensions","pushTask","taskName","taskDir","suite","suiteName","_taskOpts$externalHel","taskDirStats","actualLoc","expectLoc","execLoc","execLocAlias","taskOptsLoc","stdoutLoc","stderrLoc","sourceMapLoc","sourceMapVisualLoc","inputSourceMap","taskOpts","JSON","parse","stringify","options","_actualLoc","_execLoc","_expectLoc","files","readdirSync","file","join","Object","assign","readFile","length","console","warn","isFile","BABEL_8_BREAKING","SKIP_ON_PUBLISH","buildTestFile","fileName","code","filename","undefined","sourceMapFile","test","optionsDir","dirname","title","disabled","env","TEST_babel7plugins_babel8core","SKIP_babel7plugins_babel8core","doNotSetSourceType","DO_NOT_SET_SOURCE_TYPE","externalHelpers","validateLogs","ignoreOutput","stdout","stderr","exec","actual","expect","sourceMap","sourceMapVisual","validateSourceMapVisual","sourceMaps","minNodeVersion","minimumVersion","lt","minNodeVersionTransform","os","Array","isArray","platform","tests","push","throws","wrapPackagesArray","type","names","map","match","monorepoPath","__filename","startsWith","existsSync","resolveOptionPluginOrPreset","overrides","subOption","envName","hasOwnProperty","call","plugins","presets","get","entryLoc","suites","rootOpts","rootOptsLoc","suiteOptsLoc","multiple","categories","readFileSync","trimRight","e"],"sources":["../src/index.ts"],"sourcesContent":["import semver from \"semver\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { fileURLToPath } from \"url\";\nimport { createRequire } from \"module\";\nimport type { InputOptions } from \"@babel/core\";\nimport type { EncodedSourceMap } from \"@jridgewell/gen-mapping\";\n\nconst require = createRequire(import.meta.url);\n\nconst nodeVersion = semver.clean(process.version.slice(1));\n\nfunction humanize(val: string, noext?: boolean) {\n  if (noext) val = path.basename(val, path.extname(val));\n  return val.replace(/-/g, \" \");\n}\n\ninterface TestIO {\n  loc: string;\n  code: string;\n}\n\nexport interface TestFile extends TestIO {\n  filename: string;\n}\n\nexport interface Test {\n  taskDir: string;\n  title: string;\n  disabled: boolean | string;\n  options: TaskOptions;\n  optionsDir: string;\n  doNotSetSourceType: boolean;\n  externalHelpers: boolean;\n  ignoreOutput: boolean;\n  stdout: TestIO;\n  stderr: TestIO;\n  exec: TestFile;\n  actual: TestFile;\n  expect: TestFile;\n  inputSourceMap?: EncodedSourceMap;\n  sourceMap: string;\n  sourceMapFile: TestFile;\n  sourceMapVisual: TestFile;\n  validateSourceMapVisual: boolean;\n  validateLogs: boolean;\n}\n\nexport interface TaskOptions extends InputOptions {\n  BABEL_8_BREAKING?: boolean;\n  DO_NOT_SET_SOURCE_TYPE?: boolean;\n  SKIP_ON_PUBLISH?: boolean;\n  externalHelpers?: boolean;\n  ignoreOutput?: boolean;\n  minNodeVersion?: string;\n  minNodeVersionTransform?: string;\n  sourceMap?: boolean;\n  os?: string | string[];\n  validateLogs?: boolean;\n  throws?: boolean | string;\n  SKIP_babel7plugins_babel8core?: string;\n}\n\ntype Suite = {\n  options: TaskOptions;\n  tests: Array<Test>;\n  title: string;\n  filename: string;\n};\n\nfunction tryResolve(module: string) {\n  try {\n    return require.resolve(module);\n  } catch (_) {\n    return null;\n  }\n}\nfunction assertDirectory(loc: string) {\n  if (!fs.statSync(loc).isDirectory()) {\n    throw new Error(`Expected ${loc} to be a directory.`);\n  }\n}\n\nfunction shouldIgnore(name: string, ignore?: Array<string>) {\n  if (ignore?.includes(name)) {\n    return true;\n  }\n\n  const ext = path.extname(name);\n  const base = path.basename(name, ext);\n\n  return (\n    name[0] === \".\" ||\n    ext === \".md\" ||\n    base === \"LICENSE\" ||\n    base === \"options\" ||\n    name === \"package.json\"\n  );\n}\n\nconst EXTENSIONS = [\".js\", \".mjs\", \".ts\", \".tsx\", \".cts\", \".mts\", \".vue\"];\nconst JSON_AND_EXTENSIONS = [\".json\", ...EXTENSIONS];\n\nfunction checkFile(\n  loc: string,\n  allowJSON: boolean,\n  matchedLoc: string | undefined,\n) {\n  const ext = path.extname(loc);\n  const extensions = allowJSON ? JSON_AND_EXTENSIONS : EXTENSIONS;\n\n  if (!extensions.includes(ext)) {\n    throw new Error(`Unsupported input extension: ${loc}`);\n  }\n  if (!matchedLoc) {\n    return loc;\n  } else {\n    throw new Error(`Found conflicting file matches: ${matchedLoc},${loc}`);\n  }\n}\n\nfunction pushTask(\n  taskName: string,\n  taskDir: string,\n  suite: Suite,\n  suiteName: string,\n) {\n  const taskDirStats = fs.statSync(taskDir);\n  let actualLoc,\n    expectLoc,\n    execLoc,\n    execLocAlias,\n    taskOptsLoc,\n    stdoutLoc,\n    stderrLoc,\n    sourceMapLoc,\n    sourceMapVisualLoc,\n    inputSourceMap;\n\n  const taskOpts: TaskOptions = JSON.parse(JSON.stringify(suite.options));\n  if (taskDirStats.isDirectory()) {\n    const files = fs.readdirSync(taskDir);\n    for (const file of files) {\n      const loc = path.join(taskDir, file);\n      const name = path.basename(file, path.extname(file));\n\n      switch (name) {\n        case \"input\":\n          actualLoc = checkFile(loc, false, actualLoc);\n          break;\n        case \"exec\":\n          execLoc = checkFile(loc, false, execLoc);\n          break;\n        case \"output\":\n          expectLoc = checkFile(loc, true, expectLoc);\n          break;\n        case \"output.extended\":\n          expectLoc = checkFile(loc, true, expectLoc);\n          break;\n        case \"options\":\n          taskOptsLoc = loc;\n          Object.assign(taskOpts, require(taskOptsLoc));\n          break;\n        case \"source-map\":\n          sourceMapLoc = loc;\n          break;\n        case \"source-map-visual\":\n          sourceMapVisualLoc = loc;\n          break;\n        case \"input-source-map\":\n          inputSourceMap = JSON.parse(readFile(loc));\n          break;\n      }\n    }\n    // If neither input nor exec is present it is not a real testcase\n    if (files.length > 0 && !actualLoc && !execLoc) {\n      console.warn(`Skipped test folder with invalid layout: ${taskDir}`);\n      return;\n    }\n    actualLoc ??= taskDir + \"/input.js\";\n    execLoc ??= taskDir + \"/exec.js\";\n    expectLoc ??= taskDir + \"/output.js\";\n\n    stdoutLoc = taskDir + \"/stdout.txt\";\n    stderrLoc = taskDir + \"/stderr.txt\";\n  } else if (taskDirStats.isFile()) {\n    const ext = path.extname(taskDir);\n    if (!EXTENSIONS.includes(ext)) return;\n\n    execLoc = taskDir;\n    execLocAlias = suiteName + \"/\" + taskName;\n  } else {\n    console.warn(`Skipped test folder with invalid layout: ${taskDir}`);\n    return;\n  }\n\n  const shouldIgnore =\n    (process.env.BABEL_8_BREAKING\n      ? taskOpts.BABEL_8_BREAKING === false\n      : taskOpts.BABEL_8_BREAKING === true) ||\n    (process.env.IS_PUBLISH ? taskOpts.SKIP_ON_PUBLISH : false);\n\n  if (shouldIgnore) return;\n\n  function buildTestFile(\n    loc: string | undefined,\n    fileName?: true | string,\n  ): TestFile {\n    return {\n      loc,\n      code: readFile(loc),\n      filename: !loc\n        ? undefined\n        : fileName === true\n          ? suiteName + \"/\" + taskName + \"/\" + path.basename(loc)\n          : fileName || undefined,\n    };\n  }\n\n  const sourceMapFile = buildTestFile(sourceMapLoc, true);\n  // TODO: code should not be a object\n  sourceMapFile.code &&= JSON.parse(sourceMapFile.code);\n\n  const test: Test = {\n    taskDir,\n    optionsDir: taskOptsLoc ? path.dirname(taskOptsLoc) : null,\n    title: humanize(taskName, true),\n    disabled:\n      taskName[0] === \".\"\n        ? true\n        : (process.env.TEST_babel7plugins_babel8core &&\n            taskOpts.SKIP_babel7plugins_babel8core) ||\n          false,\n    options: taskOpts,\n    doNotSetSourceType: taskOpts.DO_NOT_SET_SOURCE_TYPE,\n    externalHelpers: taskOpts.externalHelpers ?? true,\n    validateLogs: taskOpts.validateLogs,\n    ignoreOutput: taskOpts.ignoreOutput,\n    stdout: buildTestFile(stdoutLoc),\n    stderr: buildTestFile(stderrLoc),\n    exec: buildTestFile(execLoc, execLocAlias),\n    actual: buildTestFile(actualLoc, true),\n    expect: buildTestFile(expectLoc, true),\n    sourceMap: sourceMapFile.code,\n    sourceMapFile,\n    sourceMapVisual: buildTestFile(sourceMapVisualLoc),\n    validateSourceMapVisual:\n      taskOpts.sourceMaps === true || taskOpts.sourceMaps === \"both\",\n    inputSourceMap,\n  };\n\n  if (\n    test.exec.code &&\n    test.actual.code &&\n    path.extname(execLoc) !== path.extname(actualLoc)\n  ) {\n    throw new Error(\n      `Input file extension should match exec file extension: ${execLoc}, ${actualLoc}`,\n    );\n  }\n\n  delete taskOpts.BABEL_8_BREAKING;\n  delete taskOpts.DO_NOT_SET_SOURCE_TYPE;\n  delete taskOpts.SKIP_ON_PUBLISH;\n  delete taskOpts.SKIP_babel7plugins_babel8core;\n\n  // If there's node requirement, check it before pushing task\n  if (taskOpts.minNodeVersion) {\n    const minimumVersion = semver.clean(taskOpts.minNodeVersion);\n\n    if (minimumVersion == null) {\n      throw new Error(\n        `'minNodeVersion' has invalid semver format: ${taskOpts.minNodeVersion}`,\n      );\n    }\n\n    if (semver.lt(nodeVersion, minimumVersion)) {\n      if (test.actual.code) {\n        test.exec.code = null;\n      } else {\n        return;\n      }\n    }\n\n    // Delete to avoid option validation error\n    delete taskOpts.minNodeVersion;\n  }\n\n  if (taskOpts.minNodeVersionTransform) {\n    const minimumVersion = semver.clean(taskOpts.minNodeVersionTransform);\n\n    if (minimumVersion == null) {\n      throw new Error(\n        `'minNodeVersionTransform' has invalid semver format: ${taskOpts.minNodeVersionTransform}`,\n      );\n    }\n\n    if (semver.lt(nodeVersion, minimumVersion)) {\n      return;\n    }\n\n    // Delete to avoid option validation error\n    delete taskOpts.minNodeVersionTransform;\n  }\n\n  if (taskOpts.os) {\n    let os = taskOpts.os;\n\n    if (!Array.isArray(os) && typeof os !== \"string\") {\n      throw new Error(\n        `'os' should be either string or string array: ${taskOpts.os}`,\n      );\n    }\n\n    if (typeof os === \"string\") {\n      os = [os];\n    }\n\n    if (!os.includes(process.platform)) {\n      return;\n    }\n\n    delete taskOpts.os;\n  }\n\n  suite.tests.push(test);\n\n  if (taskOpts.throws) {\n    if (test.expect.code) {\n      throw new Error(\n        \"Test cannot throw and also return output code: \" + expectLoc,\n      );\n    }\n    if (test.sourceMap) {\n      throw new Error(\n        \"Test cannot throw and also return sourcemaps: \" + sourceMapLoc,\n      );\n    }\n  }\n\n  if (!test.validateLogs && (test.stdout.code || test.stderr.code)) {\n    throw new Error(\n      \"stdout.txt and stderr.txt are only allowed when the 'validateLogs' option is enabled: \" +\n        (test.stdout.code ? stdoutLoc : stderrLoc),\n    );\n  }\n  if (test.ignoreOutput) {\n    if (test.expect.code) {\n      throw new Error(\n        \"Test cannot ignore its output and also validate it: \" + expectLoc,\n      );\n    }\n    if (!test.validateLogs) {\n      throw new Error(\n        \"ignoreOutput can only be used when validateLogs is true: \" +\n          taskOptsLoc,\n      );\n    }\n  }\n\n  // Delete to avoid option validation error\n  delete test.options.validateLogs;\n  delete test.options.ignoreOutput;\n  delete test.options.externalHelpers;\n}\n\nfunction wrapPackagesArray(\n  type: \"plugin\" | \"preset\",\n  names: (string | [string, object?, string?])[],\n  optionsDir: string,\n) {\n  return names.map(function (val) {\n    if (typeof val === \"string\") val = [val];\n\n    // relative path (outside of monorepo)\n    if (val[0][0] === \".\") {\n      if (!optionsDir) {\n        throw new Error(\n          \"Please provide an options.json in test dir when using a \" +\n            \"relative plugin path.\",\n        );\n      }\n\n      val[0] = path.resolve(optionsDir, val[0]);\n    } else {\n      let name = val[0];\n      const match = /^(@babel\\/(?:plugin-|preset-)?)(.*)$/.exec(name);\n      if (match) {\n        name = match[2];\n      }\n\n      const monorepoPath = path.join(\n        path.dirname(fileURLToPath(import.meta.url)),\n        \"../../..\",\n        name.startsWith(\"codemod\") ? \"codemods\" : \"packages\",\n        `babel-${type}-${name}/lib/index.js`,\n      );\n\n      if (fs.existsSync(monorepoPath)) {\n        if (match) {\n          throw new Error(\n            `Remove the \"${match[1]}\" prefix from \"${val[0]}\", to load it from the monorepo`,\n          );\n        }\n\n        val[0] = monorepoPath;\n      }\n    }\n\n    return val;\n  });\n}\n\n/**\n * Resolve plugins/presets defined in options.json\n *\n * @export\n * @param {{}} options the imported options.json\n * @param {string} optionsDir the directory where options.json is placed\n * @returns {any} options whose plugins/presets are resolved\n */\nexport function resolveOptionPluginOrPreset(\n  options: any,\n  optionsDir: string,\n): any {\n  if (options.overrides) {\n    for (const subOption of options.overrides) {\n      resolveOptionPluginOrPreset(subOption, optionsDir);\n    }\n  }\n  if (options.env) {\n    for (const envName in options.env) {\n      if (!Object.hasOwn(options.env, envName)) continue;\n      resolveOptionPluginOrPreset(options.env[envName], optionsDir);\n    }\n  }\n  if (options.plugins) {\n    options.plugins = wrapPackagesArray(\"plugin\", options.plugins, optionsDir);\n  }\n  if (options.presets) {\n    options.presets = wrapPackagesArray(\n      \"preset\",\n      options.presets,\n      optionsDir,\n    ).map(function (val) {\n      if (val.length > 3) {\n        throw new Error(\n          \"Unexpected extra options \" +\n            JSON.stringify(val.slice(3)) +\n            \" passed to preset.\",\n        );\n      }\n\n      return val;\n    });\n  }\n  return options;\n}\n\nexport default function get(entryLoc: string) {\n  const suites: Suite[] = [];\n\n  let rootOpts: TaskOptions = {};\n  const rootOptsLoc = tryResolve(entryLoc + \"/options\");\n  if (rootOptsLoc) rootOpts = require(rootOptsLoc);\n\n  for (const suiteName of fs.readdirSync(entryLoc)) {\n    if (shouldIgnore(suiteName)) continue;\n\n    const suite: Suite = {\n      options: { ...rootOpts },\n      tests: [],\n      title: humanize(suiteName),\n      filename: entryLoc + \"/\" + suiteName,\n    };\n\n    assertDirectory(suite.filename);\n    suites.push(suite);\n\n    const suiteOptsLoc = tryResolve(suite.filename + \"/options\");\n    if (suiteOptsLoc) {\n      suite.options = resolveOptionPluginOrPreset(\n        require(suiteOptsLoc),\n        suite.filename,\n      );\n    }\n\n    for (const taskName of fs.readdirSync(suite.filename)) {\n      pushTask(taskName, suite.filename + \"/\" + taskName, suite, suiteName);\n    }\n  }\n\n  return suites;\n}\n\nexport function multiple(entryLoc: string, ignore?: Array<string>) {\n  const categories: Record<string, unknown> = {};\n\n  for (const name of fs.readdirSync(entryLoc)) {\n    if (shouldIgnore(name, ignore)) continue;\n\n    const loc = path.join(entryLoc, name);\n    assertDirectory(loc);\n\n    categories[name] = get(loc);\n  }\n\n  return categories;\n}\n\nexport function readFile(filename: string | undefined) {\n  try {\n    if (filename === undefined) {\n      return \"\";\n    }\n    return fs.readFileSync(filename, \"utf8\").trimRight();\n  } catch (e) {\n    if (e.code === \"ENOENT\") {\n      return \"\";\n    }\n    throw e;\n  }\n}\n"],"mappings":"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","ignoreList":[]}